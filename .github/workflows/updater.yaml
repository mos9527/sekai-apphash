# Generated by Gemini 2.5 Pro Preview 03-25
name: Run Updater Script and Commit Changes

on:
  # Option 1: Run on a schedule (e.g., daily at 2 AM UTC)
  schedule:
    - cron: '0 2 * * *' # Adjust cron syntax as needed: https://crontab.guru/

  # Option 2: Allow manual triggering from the GitHub Actions UI
  workflow_dispatch:

  # Option 3 (Uncomment if needed): Run on push to the main branch
  # push:
  #   branches:
  #     - main # Or your default branch (e.g., master)

permissions:
  contents: write # Needed to commit and push changes back to the repo

jobs:
  update_and_commit:
    runs-on: ubuntu-latest # Use the latest Ubuntu runner

    steps:
      - name: Checkout repository code
        uses: actions/checkout@v4 # Fetches your code

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11' # Specify your desired Python version

      - name: Install dependencies (if any)
        run: |
          python -m pip install --upgrade pip
          python -m pip install sssekai        

      - name: Run the updater script
        env:
          QOOAPP_TOKEN: ${{ secrets.QOOAPP_TOKEN }}
        run: python updater.py

      - name: Configure Git        
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'

      - name: Stage, Commit, and Push changes        
        run: |
          git add . # Stage all changes. Be more specific if needed (e.g., git add specific_file.txt data/)
          # Check again if there's anything staged to commit (git add might not stage anything if changes were only whitespace/mode)
          if ! git diff --staged --quiet; then
            git commit -m "Automated update by updater.py" # Customize your commit message
            git push # Push the changes back to the branch the workflow is running on
          else
            echo "No effective changes were staged to commit."
          fi